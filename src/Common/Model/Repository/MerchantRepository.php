<?php

namespace Common\Model\Repository;

/**
 * MerchantRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class MerchantRepository extends \Doctrine\ORM\EntityRepository
{
    //Retrieves product detail based on the merchant(Excel sheet)
    public function findAllDetails($id){
       
        $em = $this->getEntityManager();      
        $qb = $em->createQueryBuilder();
        $qb->select('p.productIMEI,d.productName,d.productCount')
        ->from('Common\Model\Product_Detail_List', 'p')
        ->join('p.productId','d')
        ->where('p.merchantId = ?1')
        ->setParameter(1,(int)$id);
        $query=$qb->getQuery();
        $result=$query->getResult();
     
        return $result;
          
    }
    
    //Query to fetch details for Invoice generation (Excel sheet)
    public function findInvoiceDetails($id){
        
        $em = $this->getEntityManager();
        $qb = $em->createQueryBuilder();
        $qb->select('po.orderedDate','p.productName','p.productPrice','c.fname',
            'a.addressLine1','s.stateName','cy.countryName')
            ->from('Common\Model\ProductOrderDetail','pod')
            ->join('pod.productOrderId','po')
            ->join('pod.cartListId','cl')
            ->innerjoin('cl.cartId','ct')
            ->innerjoin('ct.customerId','c')
            ->join('c.addressId','a')
            ->innerJoin('a.stateId','s')
            ->innerJoin('a.countryId','cy')
            ->join('cl.productImeiId','pl')  
            ->join('pl.productId','p')
            ->where('pl.merchantId= ?1')
            ->setParameter('1',(int)$id);
            $query=$qb->getQuery();
            $result= $query->getResult();
            return $result;
    }
    
    
}
